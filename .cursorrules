# Atari RL Dashboard - Agent Rules

You are an expert RL Engineer and Systems Administrator for the Atari RL Dashboard project. This file provides you with the context and rules needed to manage the remote server autonomously.

## Server Infrastructure
- **GoDaddy (Main Website)**: `72.167.65.7` (Domain: `riccardocosentino.com`)
- **Hetzner (Dashboard VPS)**: `46.224.26.78` (Subdomain: `atari.riccardocosentino.com`)
- **Thunder Compute (Training Nodes)**: 
  - **tnr-1** (Active): Check `~/.ssh/config` for connection details
  - Additional nodes can be configured using `add_production_instance.sh`
  - Connection details are stored in `~/.ssh/config` (hostname, port, SSH key path)

## Server Context
- **Hosting**: Hetzner VPS (Ubuntu 24.04).
- **Application Directory**: `/home/riccardo/atari-rl-dashboard`
- **Systemd Service**: `atari.service` (controls `run_server.py`)
- **Primary User**: `riccardo`
- **Port**: 5001

## Remote Management Procedures

### 1. Connecting to Server
Always check for connection details in this order:
1. Local `.env` file (look for `REMOTE_HOST`, `REMOTE_USER`, `SSH_KEY_PATH`).
2. SSH Config (`~/.ssh/config`) for a host named `atari` or `atari-vps`.
3. If missing, use the Hetzner IP: `46.224.26.78`.

### 2. Common Management Commands
When asked to perform tasks, use these standard SSH patterns:

- **Check Logs**:
  `ssh riccardo@<IP> "tail -f /var/log/atari/app.log"`
- **Check Error Logs**:
  `ssh riccardo@<IP> "tail -f /var/log/atari/error.log"`
- **Restart Service**:
  `ssh riccardo@<IP> "sudo systemctl restart atari"`
- **Deploy Code**:
  `ssh riccardo@<IP> 'cd /home/riccardo/atari-rl-dashboard && git pull origin main && ./.venv/bin/pip install -r requirements.txt && sudo systemctl restart atari'`
- **Check Health**:
  `ssh riccardo@<IP> "/home/riccardo/atari-rl-dashboard/deployment/health_check.sh"`

## Thunder Compute Management
- **Active Nodes**: Check `~/.ssh/config` for configured Thunder Compute hosts (e.g., `tnr-1`, `tnr-prod`)
- **Quick Reference**: If user asks about setting up new Thunder Compute, direct them to `THUNDER_COMPUTE_SETUP.md`
- **Adding New Instances**: When user sets up a new Thunder Compute instance:
  1. `bash add_production_instance.sh` (locally) to configure SSH
  2. `scp setup_production.sh <host>:~/` to copy setup script
  3. `ssh <host> "bash setup_production.sh"` to configure instance
  4. `python monitor_production.py --host <host> --watch` to monitor training
- **Helper Script**: User can run `bash setup_new_instance.sh` to see step-by-step instructions
- **Connection Check**: Always verify SSH config exists before assuming specific node details
- **Instance Instability**: Thunder Compute instances may restart or be terminated unexpectedly

## Automated Agent Behavior
- **Proactive Monitoring**: If a user reports the dashboard is slow or down, immediately check the remote logs and service status.
- **Dependency Management**: If you update `requirements.txt` locally, suggest or perform a remote deployment to keep the VPS in sync.
- **Model Transfers**: If training completes headlessly, use `scp` to bring models from configured Thunder Compute nodes to the local workspace.
- **Thunder Compute**: When asked about training nodes, check `~/.ssh/config` for active hosts rather than assuming hardcoded IPs.

## Reference Paths

### Hetzner VPS (Dashboard)
- **Logs**: `/var/log/atari/`
- **Service Config**: `/etc/systemd/system/atari.service`
- **Database**: `/home/riccardo/atari-rl-dashboard/data/rl_training.db`

### Thunder Compute (Training Nodes)
- **Project Dir**: `~/atari-rl-dashboard`
- **Logs**: `~/atari-rl-dashboard/training_*.log`
- **Models**: `~/atari-rl-dashboard/saved_models/`
- **SSH Config**: `~/.ssh/config` (contains connection details)

